
#          Copyright Michael Florian Hava.
# Distributed under the Boost Software License, Version 1.0.
#    (See accompanying file LICENSE_1_0.txt or copy at
#          http://www.boost.org/LICENSE_1_0.txt)

CMAKE_MINIMUM_REQUIRED(VERSION 3.9)
PROJECT(PTL CXX)

OPTION(PTL_BUILD_TESTS "PTL is actually header-only, so building is only necessary to build the unit tests" OFF)

INCLUDE_DIRECTORIES(inc)

SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib/static)
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)

SET(CMAKE_CXX_STANDARD 14)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)
SET(CMAKE_CXX_EXTENSIONS OFF)

IF(PTL_BUILD_TESTS)
	FILE(GLOB_RECURSE HEADERS "inc/*")
	FILE(GLOB_RECURSE SOURCES "test/*")
	OPTION(PTL_USE_STATIC_BOOST "Use static or dynamic Boost libraries (initially selects platform default)" ${WIN32})
	SET(Boost_USE_STATIC_LIBS ${PTL_USE_STATIC_BOOST})
	SET(Boost_USE_MULTITHREADED ON)
	FIND_PACKAGE(Boost 1.59.0 REQUIRED unit_test_framework)

	ADD_EXECUTABLE(ptl-tests ${HEADERS} ${SOURCES})
	IF(NOT PTL_USE_STATIC_BOOST)
		TARGET_COMPILE_DEFINITIONS(ptl-tests PRIVATE -DBOOST_TEST_DYN_LINK)
	ENDIF()
	TARGET_LINK_LIBRARIES(ptl-tests ${Boost_UNIT_TEST_FRAMEWORK_LIBRARY})
ENDIF()

FIND_PACKAGE(Doxygen)
IF(Doxygen_FOUND)
	SET(DOXYGEN_PROJECT_NAME "Portable Template Library")
	SET(DOXYGEN_PROJECT_BRIEF "A collection of binary stable types targeted at cross-compiler interop")
	SET(DOXYGEN_OUTPUT_DIRECTORY "docs")
	SET(DOXYGEN_BUILTIN_STL_SUPPORT YES)
	SET(DOXYGEN_SHOW_USED_FILES NO)
	SET(DOXYGEN_SHOW_FILES NO)
	SET(DOXYGEN_WARN_IF_UNDOCUMENTED NO)
	SET(DOXYGEN_FILE_PATTERNS "*.hpp")
	SET(DOXYGEN_EXCLUDE_SYMBOLS "ptl::internal;ptl::internal::*")
	SET(DOXYGEN_GENERATE_TREEVIEW YES)
	SET(DOXYGEN_MACRO_EXPANSION YES)
	SET(DOXYGEN_COLLABORATION_GRAPH NO)
	DOXYGEN_ADD_DOCS(
		Documentation
		"${PROJECT_SOURCE_DIR}/inc;${PROJECT_SOURCE_DIR}/docs"
	)
ENDIF()